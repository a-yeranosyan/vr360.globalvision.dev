var allow=true;function isAllowAddHotspot(a){if(a=="false"){a=false}allow=a}function disableButton(a){if(jQuery.isArray(a)){jQuery.each(a,function(b,c){console.log(c);jQuery(c).attr("disabled","disabled");jQuery(c).hide()})}else{jQuery(a).attr("disabled","disabled");jQuery(a).hide()}}function enableButton(a){if(jQuery.isArray(a)){jQuery.each(a,function(b,c){jQuery(c).removeAttr("disabled");jQuery(c).show()})}else{jQuery(element).removeAttr("disabled");jQuery(element).show()}}function saveHotspot(c){var l=jQuery(c).data("hotspot-type");if(l==""){return false}i+=1;uniqname="spot_new_"+i;var f=krpano.get("scene.count");var o=krpano.get("xml.scene");var b=krpano.get("m_ath");var a=krpano.get("m_atv");krpano.call("addhotspot("+uniqname+");");if(typeof currentHotspotData=="undefined"){currentHotspotData={};currentHotspotData.ath=krpano.get("view.hlookat");currentHotspotData.atv=krpano.get("view.vlookat")}else{}switch(l){case"text":var k=$("#text_t").val();var g=$(textEditor.getBody()).html();g=htmlToBBCode(g);krpano.call("set(hotspot["+uniqname+"].hotspot_type, text);");krpano.call("set(hotspot["+uniqname+"].hotspot_title, "+k+" ");krpano.call("set(hotspot["+uniqname+"].hotspot_content, "+g+" ");krpano.call("set(hotspot["+uniqname+"].url, assets/images/hotspot.png);");$("#text_t").val("");$("#text_text").val("");break;case"modal":var j=$("#modal_t").val();var d=$("#modal_d").val();krpano.call("set(hotspot["+uniqname+"].hotspot_type, modal);");krpano.call("set(hotspot["+uniqname+"].modal_title, "+j+" ");krpano.call("set(hotspot["+uniqname+"].modal_content, "+d+" ");krpano.call("set(hotspot["+uniqname+"].url, assets/images/modal.png);");$("#modal_t").val("");$("#modal_d").val("");break;case"tooltip":var e=$("#tooltip_t").val();var p=$("#tooltip_d").val();krpano.call("set(hotspot["+uniqname+"].hotspot_type, tooltip);");krpano.call("set(hotspot["+uniqname+"].tooltip_title, "+e+" ");krpano.call("set(hotspot["+uniqname+"].tooltip_content, "+p+" ");krpano.call("set(hotspot["+uniqname+"].url, assets/images/tooltip.png);");$("#tooltip_t").val("");$("#tooltip_d").val("");break;case"video":var n=$("#video_url").val();if(n.length>500||(n.indexOf("https://www.youtube.com/")!==0&&n.indexOf("https://youtube.com/")!==0)){alert("Invalid video URL");return false}krpano.call("set(hotspot["+uniqname+"].hotspot_type, video);");krpano.call("set(hotspot["+uniqname+"].video_url, "+n+" ");krpano.call("set(hotspot["+uniqname+"].url, assets/images/video.png);");$("#video_url").val("");break;case"image":var m=$("#image_url").val();if(image_url.length>500||(m.indexOf("https://")!==0&&m.indexOf("http://")!==0)){alert("Invalid image URL");return false}krpano.call("set(hotspot["+uniqname+"].hotspot_type, image);");krpano.call("set(hotspot["+uniqname+"].image_url, "+m+" ");krpano.call("set(hotspot["+uniqname+"].url, assets/images/image.png);");$("#image_url").val("");break;case"linkscene":var h=$("#selectbox").val();krpano.call("set(hotspot["+uniqname+"].hotspot_type, link);");krpano.call("set(hotspot["+uniqname+"].linkedscene, "+h+");");krpano.call("set(hotspot["+uniqname+"].url, assets/images/hotspot.png);");$("#selectbox").selectpicker("reset");break}krpano.call("set(hotspot["+uniqname+"].onclick,  js(showPopup("+uniqname+")););");krpano.call("set(hotspot["+uniqname+"].onover,  js(isAllowAddHotspot(false)););");krpano.call("set(hotspot["+uniqname+"].onout,  js(isAllowAddHotspot(true)););");krpano.call("set(hotspot["+uniqname+"].ath, "+b+");");krpano.call("set(hotspot["+uniqname+"].sceneName, "+o+");");krpano.call("set(hotspot["+uniqname+"].atv, "+a+");");$("[data-popup-close]").trigger("click")}function addHotspotType(b){var a=jQuery(b).data("form");disableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link"]);jQuery("#"+a).show()}function onclickCancel(){$("#text_div").hide();$("#modal_div").hide();$("#hotspot-form-tooltip").hide();$("#image_div").hide();$("#video_div").hide();$("#link_div").hide();enableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link","#savehotspots"])}(function(a,c){if(typeof a.vrAdmin==="undefined"){a.vrAdmin={}}var b={_elements:{noticeMessage:".notice-message"},krpano:document.getElementById("krpanoSWFObject"),showActions:function(){var h=document.getElementById("krpanoSWFObject");var g,d=c("#pano");var f,e;d.mousedown(function(j){f=j.pageX;e=j.pageY;if(allow){g=setInterval(function(){var l=jQuery(this).attr("data-popup-open");c("[data-popup=popup-1]").fadeIn(350);var k=j.pageX;var m=j.pageY;h.call("screentosphere(mouse.x,mouse.y,m_ath,m_atv);");c(".popup-inner#popup").css({left:k,top:m});c(".notice-message").hide();j.preventDefault()},250);d.mousemove(function(k){if(k.pageX!=f||k.pageY!=e){clearInterval(g)}})}return false});c(document).mouseup(function(){if(allow){clearInterval(g)}return false});c("[data-popup-close]").on("click",function(k){c("#text_div").hide();c("#hotspot-form-tooltip").hide();c("#modal_div").hide();c("#video_div").hide();c("#image_div").hide();c("#link_div").hide();c("#open-add-hot").hide();c(".notice-message").show();c("#edit-remove-move").hide();c("#text_div_edit").hide();enableButton(["#hotspot-edit","#move_hotspot","#devare_hotpost"]);disableButton(["#edit_text","#edit_Tooltip","#edit_modal","#edit_image","#edit_video","#edit_link"]);enableButton(["#set_defaultView","#add_hotpost"]);enableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link"]);var j=jQuery(this).attr("data-popup-close");c('[data-popup="'+j+'"]').fadeOut(0);k.preventDefault()})},showEditHotspotForm:function(){disableButton(["#move_hotspot","#devare_hotpost","#hotspot-edit"]);c('[id*="_div_edit"][data-edit="true"]').show()},hook:{},init:function(){b.showActions();c(".selectpicker").selectpicker();b.krpano.call("autorotate.stop()")}};a.vrAdmin.Krpano=b;c(document).ready(function(){b.init()})})(window,jQuery);var textEditor=$("#hotspot-text-editor").sceditor({resizeEnabled:false,format:"bbcode",resizeMaxWidth:"265px",emoticonsRoot:"/assets/vendor/sceditor/",style:"assets/vendor/sceditor/minified/themes/content/default.min.css",plugins:"autoyoutube"}).sceditor("instance");var htmlToBBCode=function(a){a=a.replace(/<pre(.*?)>(.*?)<\/pre>/gmi,"[code]$2[/code]");a=a.replace(/<h[1-7](.*?)>(.*?)<\/h[1-7]>/,"\n[h]$2[/h]\n");a=a.replace(/<br(.*?)>/gi,"\n");a=a.replace(/<textarea(.*?)>(.*?)<\/textarea>/gmi,"[code]$2[/code]");a=a.replace(/<b>/gi,"[b]");a=a.replace(/<i>/gi,"[i]");a=a.replace(/<u>/gi,"[u]");a=a.replace(/<\/b>/gi,"[/b]");a=a.replace(/<\/i>/gi,"[/i]");a=a.replace(/<\/u>/gi,"[/u]");a=a.replace(/<em>/gi,"[b]");a=a.replace(/<\/em>/gi,"[/b]");a=a.replace(/<strong>/gi,"[b]");a=a.replace(/<\/strong>/gi,"[/b]");a=a.replace(/<cite>/gi,"[i]");a=a.replace(/<\/cite>/gi,"[/i]");a=a.replace(/<font color="(.*?)">(.*?)<\/font>/gmi,"[color=$1]$2[/color]");a=a.replace(/<font color=(.*?)>(.*?)<\/font>/gmi,"[color=$1]$2[/color]");a=a.replace(/<link(.*?)>/gi,"");a=a.replace(/<li(.*?)>(.*?)<\/li>/gi,"[*]$2");a=a.replace(/<ul(.*?)>/gi,"[list]");a=a.replace(/<\/ul>/gi,"[/list]");a=a.replace(/<div>/gi,"\n");a=a.replace(/<\/div>/gi,"\n");a=a.replace(/<td(.*?)>/gi," ");a=a.replace(/<tr(.*?)>/gi,"\n");a=a.replace(/<img(.*?)src="(.*?)"(.*?)>/gi,"[img]$2[/img]");a=a.replace(/<a(.*?)href="(.*?)"(.*?)>(.*?)<\/a>/gi,"[url=$2]$4[/url]");a=a.replace(/<head>(.*?)<\/head>/gmi,"");a=a.replace(/<object>(.*?)<\/object>/gmi,"");a=a.replace(/<script(.*?)>(.*?)<\/script>/gmi,"");a=a.replace(/<style(.*?)>(.*?)<\/style>/gmi,"");a=a.replace(/<title>(.*?)<\/title>/gmi,"");a=a.replace(/ <!--(.*?)-->/gmi,"\n");a=a.replace(/\/\//gi,"/");a=a.replace(/http:\//gi,"http://");a=a.replace(/<(?:[^>'"]*|(['"]).*?\1)*>/gmi,"");a=a.replace(/\r\r/gi,"");a=a.replace(/\[img]\//gi,"[img]");a=a.replace(/\[url=\//gi,"[url=");a=a.replace(/(\S)\n/gi,"$1 ");return a};var krpano=document.getElementById("krpanoSWFObject");var add_hotpost=document.getElementById("add_hotpost");var hotspot_done=document.getElementById("add_text");var selectbox=document.getElementById("selectbox");var showlink=document.getElementById("show_link");var i=0;var hotspots={};var uniqname="";var scene_nums=krpano.get("scene.count");var hotspotList=[];var current_scene="";var current_vTour_hotspot_counter=0;var current_randome_val=Math.round(Math.random()*1000000000).toString()+Math.round(Math.random()*1000000000).toString();function getHotspotsCount(){return krpano.get("hotspot.count")}function addHotspot(a){disableButton(["#set_defaultView","#add_hotpost"]);$("#open-add-hot").show()}function saveEdit(){var b=krpano.get("hotspot["+uniqname+"]");var a=b.hotspot_type;$("#"+a+"_div_edit").find("textarea, input, select").each(function(){var d=$(this).attr("name");var c=$(this).val();if(d=="video_url"){if(c.indexOf("https://www.youtube.com/")!==0&&c.indexOf("https://youtube.com/")!==0){alert("Invalid video URL");return false}}if(d=="image_url"){if(c.length>500||(c.indexOf("https://")!==0&&c.indexOf("http://")!==0)){alert("Invalid image URL");return false}}krpano.call("set(hotspot["+uniqname+"]."+d+", "+c+" ");$(this).val("")});if(superHotspot){superHotspot=new superHotspotObj(krpano)}$("[data-popup-close]").trigger("click")}function list_scene(){krpano.call("set(hotspot["+uniqname+"].ondown, '');");show_link.style.display="block";hotspot_done.style.display="none"}function get_link(){var a=selectbox.value;krpano.call("set(hotspot["+uniqname+"].linkedscene, "+a+");");hotspot_add_done()}var removedHotspot=[];function addRemovedHotspot(a){removedHotspot.push(a)}function devareHotspot(){if(confirm("Are you  Sure? ")==true){$("[data-popup-close]").trigger("click");done_remove()}else{return false}}function done_remove(){enableButton(["add_hotpost","#remove_hotpost","#moveHotspot","#set_defaultView"]);krpano.call("removehotspot("+uniqname+");")}function choose_hotSpot_type(){$("#hotpost_done").hide();document.getElementById("add_hotpost").style.display="inline-block";$("#choose_hotSpot_type_id").show();krpano.call("set(hotspot["+uniqname+"].ondown, '');")}function setHotSpotType_Text(){$("#choose_hotSpot_type_id").hide();$("#input_text_dialog").show();$("#input_text_dialog #text_input_hotspot").val("")}function setHotSpotType_Nomal(){$("#choose_hotSpot_type_id").hide();$("#show_link").show()}function hotspot_add_text_from_input(){$("#input_text_dialog").hide();hotspot_add_done()}function hotspot_add_done(){$("#input_text_dialog").hide();$("#show_link").hide();add_hotpost.disabled=false;enableButton(["#remove_hotpost","#moveHotspot","#set_defaultView"])}var defaultViewList={};function setDefaultView(){var a=krpano.get("xml.scene");defaultViewList[a]={};defaultViewList[a].hlookat=krpano.get("view.hlookat");defaultViewList[a].vlookat=krpano.get("view.vlookat");defaultViewList[a].fov=krpano.get("view.fov");alert("Applied default view hlookat: "+defaultViewList[a].hlookat+" , vlookat: "+defaultViewList[a].vlookat+" , fov: "+defaultViewList[a].fov)}function rotateToDefaultViewOf(a){if(typeof defaultViewList[a]!="undefined"){krpano.set("view.hlookat",defaultViewList[a].hlookat);krpano.set("view.vlookat",defaultViewList[a].vlookat);krpano.set("view.fov",defaultViewList[a].fov)}}function hmv(b,c,a){if(b.url=="assets/images/hotspot.png"){}else{addRemovedHotspot(b.name);krpano.call("set(hotspot["+a+"].xreRender, 'true')")}}function editHotspots(){krpano.call("screentosphere(mouse.x,mouse.y,m_ath,m_atv);");krpano.call("set(hotspot["+uniqname+"].onclick,  js(showPopup()););")}function moveHotspot(){var b=krpano.get("xml.scene");var c=getHotspotsCount();for(var a=0;a<c;a++){krpano.call("set(hotspot["+a+"].ondown, 'draghotspot(); js(hmv(get(hotspot["+a+"]), get(xml.scene), "+a+") );')")}disableButton(["#add_hotpost","#remove_hotpost","#set_defaultView"])}function showPopup(a){uniqname=a;var c=krpano.get("hotspot["+uniqname+"]");var b=c.hotspot_type;enableButton(["#add_hotpost","#remove_hotpost","#set_defaultView"]);$("#edit-remove-move").show();$('[id*="_div_edit"]').attr("data-edit",false).hide();$("#"+b+"_div_edit").attr("data-edit",true);$("#"+b+"_div_edit").find("textarea, input, select").each(function(){var d=$(this).attr("name");$(this).val(c[d])})}function isReady(){if(add_hotpost.disabled==false){return true}return false}function superHotspotObj(a){var b=this;this.sceneCount=a.get("scene.count");this.sceneName=a.get("xml.scene");this.hotspotList={};this.kr=a;this.firstTimesSave=0;this.saveCurrentHotspotFromCurrentScene=function(){b.hotspotList[this.sceneName]={};var d=b.kr.get("hotspot.count");for(var c=0;c<d;c++){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()]={ath:b.kr.get("hotspot["+c+"].ath"),atv:b.kr.get("hotspot["+c+"].atv"),sceneName:b.kr.get("hotspot["+c+"].sceneName"),hotspot_type:b.kr.get("hotspot["+c+"].hotspot_type"),reRender:"true"};if(b.kr.get("hotspot["+c+"].xreRender")=="true"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].reRender=="true"}else{b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].reRender="false"}if(b.kr.get("hotspot["+c+"].hotspot_type")=="text"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=b.kr.get("hotspot["+c+"].hotspot_title");b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=b.kr.get("hotspot["+c+"].hotspot_content")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="modal"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=b.kr.get("hotspot["+c+"].modal_title");b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=b.kr.get("hotspot["+c+"].modal_content")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="tooltip"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=b.kr.get("hotspot["+c+"].tooltip_title");b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=b.kr.get("hotspot["+c+"].tooltip_content")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="video"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].video_url=b.kr.get("hotspot["+c+"].video_url")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="image"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].image_url=b.kr.get("hotspot["+c+"].image_url")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="link"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].linkedscene=b.kr.get("hotspot["+c+"].linkedscene")}current_vTour_hotspot_counter++}};this.loadHotspotsToCurrentSceneFromSavedData=function(){sceneName=this.kr.get("xml.scene");for(var c in b.hotspotList[sceneName]){var d=b.hotspotList[sceneName][c];if(b.hotspotList[sceneName][c].reRender=="true"){addHotspot(d)}}for(var e in removedHotspot){if(removedHotspot[e].match(/spot_new_/g)==null){krpano.call("removehotspot("+removedHotspot[e]+");")}else{removedHotspot.splice(e,1)}}rotateToDefaultViewOf(sceneName)};this.getData=function(){if(true){b.saveCurrentHotspotFromCurrentScene()}return b};this.setData=function(c){b=c};this.initCurrentHotspots=function(){b.hotspotList[this.sceneName]={};var d=b.kr.get("hotspot.count");for(var c=0;c<d;c++){b.kr.call("set(hotspot["+c+"].onclick,  js(showPopup("+c+")););");b.kr.call("set(hotspot["+c+"].onover,  jscall(if (typeof isAllowAddHotspot !== 'undefined') isAllowAddHotspot(false)););");b.kr.call("set(hotspot["+c+"].onout,  jscall(if (typeof isAllowAddHotspot !== 'undefined') isAllowAddHotspot(true)););")}i=c};this.init=function(){setTimeout(function(){b.initCurrentHotspots()},500)};this.init()}var superHotspot;setTimeout(function(){superHotspot=new superHotspotObj(krpano)},500);