(function(a,c){var b={};b.escapeString=function(d){return escape(d)};b.validateYoutubeUrl=function(f){if(f("https://www.youtube.com/")!==0&&f.indexOf("https://youtube.com/")!==0){alert("Invalid video URL");return false}var e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;var d=f.match(e);if(d&&d[2].length==11){return d[2]}return false};b.validateImageUrl=function(d){if(d.length>500||(d.indexOf("https://")!==0&&d.indexOf("http://")!==0)){alert("Invalid image URL");return false}return true};a.vrUtilities=b}(window,jQuery.noConflict()));(function(a,c){var b={element:{btnAddHotspot:"#add-hotspot",btnSetDefaultView:"#set-default-view",noticeMessage:".notice-message",krpano:"#pano"},krpano:document.getElementById("krpanoSWFObject")};b.uniqName="";b.add=function(e,d){var f=b.krpano;switch(d){case"hotspot":f.call("addhotspot("+e.name+");");break}c.each(e,function(g,h){if(g!="name"){f.call("set(hotspot["+e.name+"]."+g+","+h+");")}});f.call("set(hotspot["+e.name+"].onclick,  js(vrKrpano.editHotspot("+e.name+")););");f.call("set(hotspot["+e.name+"].onover,  js(isAllowAddHotspot(false)););");f.call("set(hotspot["+e.name+"].onout,  js(isAllowAddHotspot(true)););")};b.remove=function(d){if(confirm("Are you sure ?")==true){switch(d){case"hotspot":enableButton(["add_hotpost","#remove_hotpost","#moveHotspot","#set-default-view"]);krpano.call("removehotspot("+b.uniqName+");");jQuery("[data-popup-close]").trigger("click");break}}else{return false}};b.update=function(d){var f=b.getItem(b.uniqName);var h=f.hotspot_type;switch(d){case"editText":jQuery("#hotspot-form-"+h).find("textarea, input, select").each(function(){var k=jQuery(this).attr("name");var j=jQuery(this).val();if(k=="video_url"){j=a.vrUtilities.validateYoutubeUrl(j);if(j===false){return false}}if(k=="image_url"){if(!a.vrUtilities.validateImageUrl(j)){return false}}krpano.call("set(hotspot["+b.uniqName+"]."+a.vrUtilities.escapeString(k)+", "+a.vrUtilities.escapeString(j)+" ");jQuery(this).val("");jQuery("[data-popup-close]").trigger("click")});break;case"updateHotspotPosition":var e=krpano.get("xml.scene");var g=krpano.get("hotspot.count");krpano.call("set(hotspot["+b.uniqName+"].ondown, 'draghotspot(); js(hmv(get(hotspot["+b.uniqName+"]), get(xml.scene), "+b.uniqName+") );')");disableButton(["#add-hotspot","#remove_hotpost","#set-default-view"]);jQuery("[data-popup-close]").trigger("click");break}};b.getItem=function(d){if(krpano.get("hotspot["+d+"]")){return krpano.get("hotspot["+d+"]")}else{return null}};b.getItems=function(){var d=[];var f=krpano.get("hotspot.count");for(var e=0;e>=f;e++){d.push(b.getItem(e))}return d};b.editHotspot=function(e){var g=krpano.get("xml.scene");jQuery("#selectbox option").show();jQuery("#selectbox").find("[value='"+g+"']").hide();jQuery("#selectbox").selectpicker("refresh");jQuery("#selectbox").selectpicker("val",1);b.uniqName=e;var f=krpano.get("hotspot["+e+"]");var k=f.hotspot_type;var h=jQuery("#popup").attr("data-mode","edit");var d=event.pageX;var j=event.pageY;jQuery(".popup-inner#popup").css({left:d,top:j});jQuery("[data-popup=popup-1]").show();b.closeHotspotForm();b.hideHotspotTypes()};b.editText=function(){var d=krpano.get("hotspot["+b.uniqName+"]");var e=d.hotspot_type;disableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link"]);b.showHotspotTypes();jQuery('[id*="hotspot-form-"]').attr("data-edit",false).hide();jQuery("#hotspot-form-"+e).attr("data-edit",true);jQuery("#hotspot-form-"+e).find("textarea, input, select").each(function(){var f=jQuery(this).attr("name");jQuery(this).val(decodeURIComponent(d[f]))});jQuery('[id*="hotspot-form-"][data-edit="true"]').show()};b.clickAction=function(){var h=document.getElementById("krpanoSWFObject");var g,d=c(b.element.krpano);var f,e;d.mousedown(function(j){f=j.pageX;e=j.pageY;if(allow){g=setInterval(function(){var l=jQuery(this).attr("data-popup-open");var m=jQuery("#popup").attr("data-mode","add");disableButton(["#hotspot-edit","#hotspot-move","#hotpost-delete"]);c(this).attr("data-form","hotspot-form-");c("[data-popup=popup-1]").fadeIn(350);var k=j.pageX;var n=j.pageY;h.call("screentosphere(mouse.x,mouse.y,m_ath,m_atv);");c(".popup-inner#popup").css({left:k,top:n});c(".notice-message").hide();j.preventDefault()},250);d.mousemove(function(k){if(k.pageX!=f||k.pageY!=e){clearInterval(g)}})}return false});c(document).mouseup(function(){if(allow){clearInterval(g)}return false});c("[data-popup-close]").on("click",function(k){c("#hotspot-form-text").hide();c("#hotspot-form-tooltip").hide();c("#hotspot-form-modal").hide();c("#hotspot-form-video").hide();c("#hotspot-form-image").hide();c("#hotspot-form-link").hide();c("#choose-hotspot-type").hide();c(".notice-message").show();c("#edit-remove-move").hide();enableButton(["#hotspot-edit","#hotspot-move","#hotpost-delete"]);disableButton(["#edit_text","#edit_Tooltip","#edit_modal","#edit_image","#edit_video","#edit_link"]);enableButton(["#set-default-view","#add-hotspot"]);enableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link"]);var j=jQuery(this).attr("data-popup-close");c('[data-popup="'+j+'"]').fadeOut(0);k.preventDefault()})};b.showHotspotTypes=function(){disableButton([b.element.btnAddHotspot,b.element.btnSetDefaultView]);c("#choose-hotspot-type").show()};b.hideHotspotTypes=function(){disableButton([b.element.btnAddHotspot,b.element.btnSetDefaultView]);c("#choose-hotspot-type").hide()};b.setDefaultView=function(){var d=krpano.get("xml.scene");defaultViewList[d]={};defaultViewList[d].hlookat=krpano.get("view.hlookat");defaultViewList[d].vlookat=krpano.get("view.vlookat");defaultViewList[d].fov=krpano.get("view.fov");alert("Applied default view hlookat: "+defaultViewList[d].hlookat+" , vlookat: "+defaultViewList[d].vlookat+" , fov: "+defaultViewList[d].fov)};b.showHotspotForm=function(e,f){var d=jQuery(e).data("form");var g=krpano.get("xml.scene");jQuery("#selectbox option").show();jQuery("#selectbox").find("[value='"+g+"']").hide();jQuery("#selectbox").selectpicker("refresh");jQuery("#selectbox").selectpicker("val",1);disableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link"]);jQuery("#"+d).show()};b.closeHotspotForm=function(){var d=jQuery("#popup").attr("data-mode");switch(d){case"add":disableButton(["#hotspot-form-text","#hotspot-form-modal","#hotspot-form-tooltip","#hotspot-form-image","#hotspot-form-video","#hotspot-form-link"]);enableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link","#savehotspots"]);break;case"edit":disableButton(["#hotspot-form-text","#hotspot-form-modal","#hotspot-form-tooltip","#hotspot-form-image","#hotspot-form-video","#hotspot-form-link"]);break}};b.saveHotspot=function(g){var k=jQuery(g).data("hotspot-type");var j=jQuery("#popup").attr("data-mode");if(j=="edit"){b.update("editText");return}if(""==k){return !1}i+=1,uniqname="spot_new_"+i;var f=(krpano.get("scene.count"),krpano.get("xml.scene"));mouseAth=krpano.get("m_ath"),mouseAtv=krpano.get("m_atv");var h={name:uniqname,ath:krpano.get("m_ath"),atv:krpano.get("m_atv"),sceneName:(krpano.get("scene.count"),krpano.get("xml.scene"))};switch(k){case"text":if(jQuery("#text-title-editor").val().length<1){return alert("Enter title"),!1}h.hotspot_type="text";h.hotspot_title=a.vrUtilities.escapeString(jQuery("#text-title-editor").val());h.hotspot_content=a.vrUtilities.escapeString(jQuery("#text-description-editor").val());h.url="assets/vendor/krpano/viewer/skin/images/text.png";jQuery("#text-title-editor").val(""),jQuery("#text-description-editor").val("");break;case"modal":if(jQuery("#modal-title-editor").val().length<1){return alert("Enter title"),!1}h.hotspot_type="modal";h.modal_title=a.vrUtilities.escapeString(jQuery("#modal-title-editor").val());h.modal_content=a.vrUtilities.escapeString(jQuery("#modal-description-editor").val());h.url="assets/vendor/krpano/viewer/skin/images/modal.png";jQuery("#modal-title-editor").val(""),jQuery("#modal-description-editor").val("");break;case"tooltip":if(jQuery("#tooltip-title-editor").val().length<1){return alert("Enter title"),!1}h.hotspot_type="tooltip";h.tooltip_title=a.vrUtilities.escapeString(jQuery("#tooltip-title-editor").val());h.tooltip_content=a.vrUtilities.escapeString(jQuery("#tooltip-description-editor").val());h.url="assets/vendor/krpano/viewer/skin/images/tooltip.png";jQuery("#text-title-editor").val(""),jQuery("#tooltip-description-editor").val("");break;case"video":var e=jQuery("#video-url-editor").val();if(e.length>500||0!==e.indexOf("https://www.youtube.com/")&&0!==e.indexOf("https://youtube.com/")){return alert("Invalid video URL"),!1}h.hotspot_type="video";h.video_url=e;h.url=" assets/vendor/krpano/viewer/skin/images/video.png";jQuery("#video-url-editor").val("");break;case"image":var d=jQuery("#image-url-editor").val();if(d.length>500||0!==d.indexOf("https://")&&0!==d.indexOf("http://")){return alert("Invalid image URL"),!1}h.hotspot_type="image";h.image_url=d;h.url=" assets/vendor/krpano/viewer/skin/images/image.png";jQuery("#image-url-editor").val("");break;case"linkscene":if(jQuery("#selectbox").val()===null){alert("You must select from List");return}h.hotspot_type="link";h.linkedscene=jQuery("#selectbox").val();h.url="assets/vendor/krpano/viewer/skin/images/linked_edit_mode.png";break}b.add(h,"hotspot");jQuery("[data-popup-close]").trigger("click")};b.isEditCompleted=function(){return true};b.isAllowAddHotspot=function(d){};b.init=function(){b.clickAction();c(".selectpicker").selectpicker()};c(document).ready(function(){b.init()});a.vrKrpano=b})(window,jQuery.noConflict());var allow=true;function isAllowAddHotspot(a){if(a=="false"){a=false}allow=a}function disableButton(a){if(jQuery.isArray(a)){jQuery.each(a,function(b,c){jQuery(c).attr("disabled","disabled");jQuery(c).hide()})}else{jQuery(a).attr("disabled","disabled");jQuery(a).hide()}}function enableButton(a){if(jQuery.isArray(a)){jQuery.each(a,function(b,c){jQuery(c).removeAttr("disabled");jQuery(c).show()})}else{jQuery(element).removeAttr("disabled");jQuery(element).show()}}var htmlToBBCode=function(a){a=a.replace(/<pre(.*?)>(.*?)<\/pre>/gmi,"[code]$2[/code]");a=a.replace(/<h[1-7](.*?)>(.*?)<\/h[1-7]>/,"\n[h]$2[/h]\n");a=a.replace(/<br(.*?)>/gi,"\n");a=a.replace(/<textarea(.*?)>(.*?)<\/textarea>/gmi,"[code]$2[/code]");a=a.replace(/<b>/gi,"[b]");a=a.replace(/<i>/gi,"[i]");a=a.replace(/<u>/gi,"[u]");a=a.replace(/<\/b>/gi,"[/b]");a=a.replace(/<\/i>/gi,"[/i]");a=a.replace(/<\/u>/gi,"[/u]");a=a.replace(/<em>/gi,"[b]");a=a.replace(/<\/em>/gi,"[/b]");a=a.replace(/<strong>/gi,"[b]");a=a.replace(/<\/strong>/gi,"[/b]");a=a.replace(/<cite>/gi,"[i]");a=a.replace(/<\/cite>/gi,"[/i]");a=a.replace(/<font color="(.*?)">(.*?)<\/font>/gmi,"[color=$1]$2[/color]");a=a.replace(/<font color=(.*?)>(.*?)<\/font>/gmi,"[color=$1]$2[/color]");a=a.replace(/<link(.*?)>/gi,"");a=a.replace(/<li(.*?)>(.*?)<\/li>/gi,"[*]$2");a=a.replace(/<ul(.*?)>/gi,"[list]");a=a.replace(/<\/ul>/gi,"[/list]");a=a.replace(/<div>/gi,"\n");a=a.replace(/<\/div>/gi,"\n");a=a.replace(/<td(.*?)>/gi," ");a=a.replace(/<tr(.*?)>/gi,"\n");a=a.replace(/<img(.*?)src="(.*?)"(.*?)>/gi,"[img]$2[/img]");a=a.replace(/<a(.*?)href="(.*?)"(.*?)>(.*?)<\/a>/gi,"[url=$2]$4[/url]");a=a.replace(/<head>(.*?)<\/head>/gmi,"");a=a.replace(/<object>(.*?)<\/object>/gmi,"");a=a.replace(/<script(.*?)>(.*?)<\/script>/gmi,"");a=a.replace(/<style(.*?)>(.*?)<\/style>/gmi,"");a=a.replace(/<title>(.*?)<\/title>/gmi,"");a=a.replace(/ <!--(.*?)-->/gmi,"\n");a=a.replace(/\/\//gi,"/");a=a.replace(/http:\//gi,"http://");a=a.replace(/<(?:[^>'"]*|(['"]).*?\1)*>/gmi,"");a=a.replace(/\r\r/gi,"");a=a.replace(/\[img]\//gi,"[img]");a=a.replace(/\[url=\//gi,"[url=");a=a.replace(/(\S)\n/gi,"$1 ");return a};var krpano=document.getElementById("krpanoSWFObject");var add_hotpost=document.getElementById("add_hotpost");var hotspot_done=document.getElementById("add_text");var selectbox=document.getElementById("selectbox");var showlink=document.getElementById("show_link");var i=0;var hotspots={};var uniqname="";var scene_nums=krpano.get("scene.count");var hotspotList=[];var current_scene="";var current_vTour_hotspot_counter=0;var current_randome_val=Math.round(Math.random()*1000000000).toString()+Math.round(Math.random()*1000000000).toString();var removedHotspot=[];function addRemovedHotspot(a){removedHotspot.push(a)}var defaultViewList={};function rotateToDefaultViewOf(a){if(typeof defaultViewList[a]!="undefined"){krpano.set("view.hlookat",defaultViewList[a].hlookat);krpano.set("view.vlookat",defaultViewList[a].vlookat);krpano.set("view.fov",defaultViewList[a].fov)}}function hmv(b,c,a){if(b.url=="assets/images/hotspot.png"){}else{addRemovedHotspot(b.name);krpano.call("set(hotspot["+a+"].xreRender, 'true')")}}function superHotspotObj(a){var b=this;this.sceneCount=a.get("scene.count");this.sceneName=a.get("xml.scene");this.hotspotList={};this.kr=a;this.firstTimesSave=0;this.saveCurrentHotspotFromCurrentScene=function(){b.hotspotList[this.sceneName]={};var d=b.kr.get("hotspot.count");for(var c=0;c<d;c++){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()]={ath:b.kr.get("hotspot["+c+"].ath"),atv:b.kr.get("hotspot["+c+"].atv"),sceneName:b.kr.get("hotspot["+c+"].sceneName"),hotspot_type:b.kr.get("hotspot["+c+"].hotspot_type"),reRender:"true"};if(b.kr.get("hotspot["+c+"].xreRender")=="true"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].reRender=="true"}else{b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].reRender="false"}if(b.kr.get("hotspot["+c+"].hotspot_type")=="text"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=b.kr.get("hotspot["+c+"].hotspot_title");b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=b.kr.get("hotspot["+c+"].hotspot_content")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="modal"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=b.kr.get("hotspot["+c+"].modal_title");b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=b.kr.get("hotspot["+c+"].modal_content")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="tooltip"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=b.kr.get("hotspot["+c+"].tooltip_title");b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=b.kr.get("hotspot["+c+"].tooltip_content")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="video"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].video_url=b.kr.get("hotspot["+c+"].video_url")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="image"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].image_url=b.kr.get("hotspot["+c+"].image_url")}if(b.kr.get("hotspot["+c+"].hotspot_type")=="link"){b.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].linkedscene=b.kr.get("hotspot["+c+"].linkedscene")}current_vTour_hotspot_counter++}};this.loadHotspotsToCurrentSceneFromSavedData=function(){sceneName=this.kr.get("xml.scene");for(var c in b.hotspotList[sceneName]){var d=b.hotspotList[sceneName][c];if(b.hotspotList[sceneName][c].reRender=="true"){addHotspot(d)}}for(var e in removedHotspot){if(removedHotspot[e].match(/spot_new_/g)==null){krpano.call("removehotspot("+removedHotspot[e]+");")}else{removedHotspot.splice(e,1)}}rotateToDefaultViewOf(sceneName)};this.getData=function(){if(true){b.saveCurrentHotspotFromCurrentScene()}return b};this.setData=function(c){b=c};this.initCurrentHotspots=function(){b.hotspotList[this.sceneName]={};var d=b.kr.get("hotspot.count");for(var c=0;c<d;c++){b.kr.call("set(hotspot["+c+"].onclick,  js(vrKrpano.editHotspot("+c+")););");b.kr.call("set(hotspot["+c+"].onover,  jscall(if (typeof isAllowAddHotspot !== 'undefined') isAllowAddHotspot(false)););");b.kr.call("set(hotspot["+c+"].onout,  jscall(if (typeof isAllowAddHotspot !== 'undefined') isAllowAddHotspot(true)););")}i=c};this.init=function(){setTimeout(function(){b.initCurrentHotspots()},500)};this.init()}var superHotspot;setTimeout(function(){superHotspot=new superHotspotObj(krpano)},500);