function isAllowAddHotspot(t){"false"==t&&(t=!1),allow=t}function disableButton(t){jQuery.isArray(t)?jQuery.each(t,function(t,e){jQuery(e).attr("disabled","disabled"),jQuery(e).hide()}):(jQuery(t).attr("disabled","disabled"),jQuery(t).hide())}function enableButton(t){jQuery.isArray(t)?jQuery.each(t,function(t,e){jQuery(e).removeAttr("disabled"),jQuery(e).show()}):(jQuery(element).removeAttr("disabled"),jQuery(element).show())}function saveHotspot(t){var e=jQuery(t).data("hotspot-type");if(""==e)return!1;i+=1,uniqname="spot_new_"+i;var o=(krpano.get("scene.count"),krpano.get("xml.scene")),n=krpano.get("m_ath"),a=krpano.get("m_atv");switch(krpano.call("addhotspot("+uniqname+");"),"undefined"==typeof currentHotspotData&&(currentHotspotData={},currentHotspotData.ath=krpano.get("view.hlookat"),currentHotspotData.atv=krpano.get("view.vlookat")),e){case"text":var s=removeTags($("#text-title-editor").val()),r=removeTags($("#text-description-editor").val());if($("#text-title-editor").val().length<1)return alert("Enter title"),!1;krpano.call("set(hotspot["+uniqname+"].hotspot_type, text);"),krpano.call("set(hotspot["+uniqname+"].hotspot_title, '"+s+"' "),krpano.call("set(hotspot["+uniqname+"].hotspot_content, '"+r+"' "),krpano.call("set(hotspot["+uniqname+"].url, assets/vendor/krpano/viewer/skin/images/text.png);"),$("#text-title-editor").val(""),$("#text-description-editor").val("");break;case"modal":var p=removeTags($("#modal-title-editor").val()),l=removeTags($("#modal-description-editor").val());krpano.call("set(hotspot["+uniqname+"].hotspot_type, modal);"),krpano.call("set(hotspot["+uniqname+"].modal_title, '"+p+"' "),krpano.call("set(hotspot["+uniqname+"].modal_content, '"+l+"' "),krpano.call("set(hotspot["+uniqname+"].url, assets/vendor/krpano/viewer/skin/images/modal.png);"),$("#modal-title-editor").val(""),$("#modal-description-editor").val("");break;case"tooltip":var d=removeTags($("#text-title-editor").val()),u=removeTags($("#tooltip-description-editor").val());krpano.call("set(hotspot["+uniqname+"].hotspot_type, tooltip);"),krpano.call("set(hotspot["+uniqname+"].tooltip_title, '"+d+"' "),krpano.call("set(hotspot["+uniqname+"].tooltip_content, '"+u+"' "),krpano.call("set(hotspot["+uniqname+"].url, assets/vendor/krpano/viewer/skin/images/tooltip.png);"),$("#text-title-editor").val(""),$("#tooltip-description-editor").val("");break;case"video":var c=$("#video-url-editor").val();if(c.length>500||0!==c.indexOf("https://www.youtube.com/")&&0!==c.indexOf("https://youtube.com/"))return alert("Invalid video URL"),!1;krpano.call("set(hotspot["+uniqname+"].hotspot_type, video);"),krpano.call("set(hotspot["+uniqname+"].video_url, '"+c+"' "),krpano.call("set(hotspot["+uniqname+"].url, assets/vendor/krpano/viewer/skin/images/video.png);"),$("#video-url-editor").val("");break;case"image":var h=$("#image-url-editor").val();if(image_url.length>500||0!==h.indexOf("https://")&&0!==h.indexOf("http://"))return alert("Invalid image URL"),!1;krpano.call("set(hotspot["+uniqname+"].hotspot_type, image);"),krpano.call("set(hotspot["+uniqname+"].image_url, '"+h+"' "),krpano.call("set(hotspot["+uniqname+"].url, assets/vendor/krpano/viewer/skin/images/image.png);"),$("#image-url-editor").val("");break;case"linkscene":var m=removeTags($("#selectbox").val());krpano.call("set(hotspot["+uniqname+"].hotspot_type, link);"),krpano.call("set(hotspot["+uniqname+"].linkedscene, '"+m+"');"),krpano.call("set(hotspot["+uniqname+"].url, assets/vendor/krpano/viewer/skin/images/linked_edit_mode.png);"),$("#selectbox").selectpicker("reset")}krpano.call("set(hotspot["+uniqname+"].onclick,  js(showPopup("+uniqname+")););"),krpano.call("set(hotspot["+uniqname+"].onover,  js(isAllowAddHotspot(false)););"),krpano.call("set(hotspot["+uniqname+"].onout,  js(isAllowAddHotspot(true)););"),krpano.call("set(hotspot["+uniqname+"].ath, "+n+");"),krpano.call("set(hotspot["+uniqname+"].sceneName, "+o+");"),krpano.call("set(hotspot["+uniqname+"].atv, "+a+");"),$("[data-popup-close]").trigger("click")}function addHotspotType(t){var e=jQuery(t).data("form");disableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link"]),jQuery("#"+e).show()}function editText(){disableButton(["#edit_Tooltip","#edit_modal","#edit_image","#edit_video","#edit_link","#saveEdit"]),$("#text_div_edit").show()}function editTooltip(){disableButton(["#edit_text","#edit_modal","#edit_image","#edit_video","#edit_link","#saveEdit"]),$("#tooltip_div_edit").show()}function editModal(){disableButton(["#edit_text","#edit_Tooltip","#edit_image","#edit_video","#edit_link","#saveEdit"]),$("#modal_div_edit").show()}function editImage(){disableButton(["#edit_text","#edit_modal","#edit_Tooltip","#edit_video","#edit_link","#saveEdit"]),$("#image_div_edit").show()}function editVideo(){disableButton(["#edit_text","#edit_modal","#edit_Tooltip","#edit_image","#edit_link","#saveEdit"]),$("#video_div_edit").show()}function editScene(){disableButton(["#edit_text","#edit_modal","#edit_Tooltip","#edit_image","#edit_video","#saveEdit"]),$("#scene_div_edit").show()}function removeTags(t){return t=t.replace('"',"'")}function onclickCancel(){$("#hotspot-form-text").hide(),$("#hotspot-form-tooltip").hide(),$("#hotspot-form-modal").hide(),$("#hotspot-form-image").hide(),$("#hotspot-form-video").hide(),$("#hotspot-form-link").hide(),enableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link","#savehotspots"])}function getHotspotsCount(){return krpano.get("hotspot.count")}function addHotspot(t){disableButton(["#set_defaultView","#add_hotpost"]),$("#open-add-hot").show()}function saveEdit(){var t=krpano.get("hotspot["+uniqname+"]"),e=t.hotspot_type;$("#"+e+"_div_edit").find("textarea, input, select").each(function(){var t=$(this).attr("name"),e=$(this).val();return"video-url-editor"==t&&0!==e.indexOf("https://www.youtube.com/")&&0!==e.indexOf("https://youtube.com/")?(alert("Invalid video URL"),!1):"image-url-editor"==t&&(e.length>500||0!==e.indexOf("https://")&&0!==e.indexOf("http://"))?(alert("Invalid image URL"),!1):(krpano.call("set(hotspot["+uniqname+"]."+t+", "+e+" "),void $(this).val(""))}),superHotspot&&(superHotspot=new superHotspotObj(krpano)),$("[data-popup-close]").trigger("click")}function editHotspot(){disableButton(["#move_hotspot","#devare_hotpost","#edit_hotpost"]),$('[id*="_div_edit"][data-edit="true"]').show()}function list_scene(){krpano.call("set(hotspot["+uniqname+"].ondown, '');"),show_link.style.display="block",hotspot_done.style.display="none"}function get_link(){var t=selectbox.value;krpano.call("set(hotspot["+uniqname+"].linkedscene, "+t+");"),hotspot_add_done()}function addRemovedHotspot(t){removedHotspot.push(t)}function devareHotspot(){return 1!=confirm("Are you  Sure? ")?!1:($("[data-popup-close]").trigger("click"),void done_remove())}function done_remove(){enableButton(["add_hotpost","#remove_hotpost","#moveHotspot","#set_defaultView"]),krpano.call("removehotspot("+uniqname+");")}function choose_hotSpot_type(){$("#hotpost_done").hide(),document.getElementById("add_hotpost").style.display="inline-block",$("#choose_hotSpot_type_id").show(),krpano.call("set(hotspot["+uniqname+"].ondown, '');")}function setHotSpotType_Text(){$("#choose_hotSpot_type_id").hide(),$("#input_text_dialog").show(),$("#input_text_dialog #text_input_hotspot").val("")}function setHotSpotType_Nomal(){$("#choose_hotSpot_type_id").hide(),$("#show_link").show()}function hotspot_add_text_from_input(){$("#input_text_dialog").hide(),hotspot_add_done()}function hotspot_add_done(){$("#input_text_dialog").hide(),$("#show_link").hide(),add_hotpost.disabled=!1,enableButton(["#remove_hotpost","#moveHotspot","#set_defaultView"])}function setDefaultView(){var t=krpano.get("xml.scene");defaultViewList[t]={},defaultViewList[t].hlookat=krpano.get("view.hlookat"),defaultViewList[t].vlookat=krpano.get("view.vlookat"),defaultViewList[t].fov=krpano.get("view.fov"),alert("Applied default view hlookat: "+defaultViewList[t].hlookat+" , vlookat: "+defaultViewList[t].vlookat+" , fov: "+defaultViewList[t].fov)}function rotateToDefaultViewOf(t){"undefined"!=typeof defaultViewList[t]&&(krpano.set("view.hlookat",defaultViewList[t].hlookat),krpano.set("view.vlookat",defaultViewList[t].vlookat),krpano.set("view.fov",defaultViewList[t].fov))}function hmv(t,e,o){"assets/images/hotspot.png"==t.url||(addRemovedHotspot(t.name),krpano.call("set(hotspot["+o+"].xreRender, 'true')"))}function moveHotspot(){for(var t=(krpano.get("xml.scene"),getHotspotsCount()),e=0;t>e;e++)krpano.call("set(hotspot["+e+"].ondown, 'draghotspot(); js(hmv(get(hotspot["+e+"]), get(xml.scene), "+e+") );')");disableButton(["#add_hotpost","#remove_hotpost","#set_defaultView"])}function showPopup(t){uniqname=t;var e=krpano.get("hotspot["+uniqname+"]"),o=e.hotspot_type;enableButton(["#add_hotpost","#remove_hotpost","#set_defaultView"]),$("#edit-remove-move").show(),$('[id*="hotspot-form-"]').attr("data-edit",!1).hide(),$("#hotspot-form-"+o).attr("data-edit",!0),$("#hotspot-form-"+o).show(),$("#hotspot-form-"+o).find("textarea, input, select").each(function(){var t=$(this).attr("name");console.log(e),$(this).val(e[t])})}function isReady(){return 0==add_hotpost.disabled?!0:!1}function superHotspotObj(t){var e=this;this.sceneCount=t.get("scene.count"),this.sceneName=t.get("xml.scene"),this.hotspotList={},this.kr=t,this.firstTimesSave=0,this.saveCurrentHotspotFromCurrentScene=function(){e.hotspotList[this.sceneName]={};for(var t=e.kr.get("hotspot.count"),o=0;t>o;o++)e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()]={ath:e.kr.get("hotspot["+o+"].ath"),atv:e.kr.get("hotspot["+o+"].atv"),sceneName:e.kr.get("hotspot["+o+"].sceneName"),hotspot_type:e.kr.get("hotspot["+o+"].hotspot_type"),reRender:"true"},"true"==e.kr.get("hotspot["+o+"].xreRender")?"true"==e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].reRender:e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].reRender="false","text"==e.kr.get("hotspot["+o+"].hotspot_type")&&(e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=e.kr.get("hotspot["+o+"].hotspot_title"),e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=e.kr.get("hotspot["+o+"].hotspot_content")),"modal"==e.kr.get("hotspot["+o+"].hotspot_type")&&(e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=e.kr.get("hotspot["+o+"].modal_title"),e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=e.kr.get("hotspot["+o+"].modal_content")),"tooltip"==e.kr.get("hotspot["+o+"].hotspot_type")&&(e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].title=e.kr.get("hotspot["+o+"].tooltip_title"),e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].content=e.kr.get("hotspot["+o+"].tooltip_content")),"video"==e.kr.get("hotspot["+o+"].hotspot_type")&&(e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].video_url=e.kr.get("hotspot["+o+"].video_url")),"image"==e.kr.get("hotspot["+o+"].hotspot_type")&&(e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].image_url=e.kr.get("hotspot["+o+"].image_url")),"link"==e.kr.get("hotspot["+o+"].hotspot_type")&&(e.hotspotList[this.sceneName][current_randome_val+current_vTour_hotspot_counter.toString()].linkedscene=e.kr.get("hotspot["+o+"].linkedscene")),current_vTour_hotspot_counter++},this.loadHotspotsToCurrentSceneFromSavedData=function(){sceneName=this.kr.get("xml.scene");for(var t in e.hotspotList[sceneName]){var o=e.hotspotList[sceneName][t];"true"==e.hotspotList[sceneName][t].reRender&&addHotspot(o)}for(var i in removedHotspot)null==removedHotspot[i].match(/spot_new_/g)?krpano.call("removehotspot("+removedHotspot[i]+");"):removedHotspot.splice(i,1);rotateToDefaultViewOf(sceneName)},this.getData=function(){return e.saveCurrentHotspotFromCurrentScene(),e},this.setData=function(t){e=t},this.initCurrentHotspots=function(){e.hotspotList[this.sceneName]={};for(var t=e.kr.get("hotspot.count"),o=0;t>o;o++)e.kr.call("set(hotspot["+o+"].onclick,  js(showPopup("+o+")););"),e.kr.call("set(hotspot["+o+"].onover,  jscall(if (typeof isAllowAddHotspot !== 'undefined') isAllowAddHotspot(false)););"),e.kr.call("set(hotspot["+o+"].onout,  jscall(if (typeof isAllowAddHotspot !== 'undefined') isAllowAddHotspot(true)););");i=o},this.init=function(){setTimeout(function(){e.initCurrentHotspots()},500)},this.init()}var allow=!0;!function(t,e){"undefined"==typeof t.vrAdmin&&(t.vrAdmin={});var o={_elements:{noticeMessage:".notice-message"},showActions:function(){var t,o,i,n=document.getElementById("krpanoSWFObject"),a=e("#pano");a.mousedown(function(s){return o=s.pageX,i=s.pageY,allow&&(t=setInterval(function(){jQuery(this).attr("data-popup-open");e("[data-popup=popup-1]").fadeIn(350);var t=s.pageX,o=s.pageY;n.call("screentosphere(mouse.x,mouse.y,m_ath,m_atv);"),e(".popup-inner#popup").css({left:t,top:o}),e(".notice-message").hide(),s.preventDefault()},250),a.mousemove(function(e){(e.pageX!=o||e.pageY!=i)&&clearInterval(t)})),!1}),e(document).mouseup(function(){return allow&&clearInterval(t),!1}),e("[data-popup-close]").on("click",function(t){e("#hotspot-form-text").hide(),e("#hotspot-form-tooltip").hide(),e("#hotspot-form-tooltip").hide(),e("#hotspot-form-video").hide(),e("#hotspot-form-image").hide(),e("#hotspot-form-link").hide(),e("#open-add-hot").hide(),e(".notice-message").show(),e("#edit-remove-move").hide(),e("#text_div_edit").hide(),enableButton(["#edit_hotpost","#move_hotspot","#devare_hotpost"]),disableButton(["#edit_text","#edit_Tooltip","#edit_modal","#edit_image","#edit_video","#edit_link"]),enableButton(["#set_defaultView","#add_hotpost"]),enableButton(["#add_text","#add_Tooltip","#add_Modal","#add_image","#add_video","#add_link"]);var o=jQuery(this).attr("data-popup-close");e('[data-popup="'+o+'"]').fadeOut(0),t.preventDefault()})},hook:{},init:function(){o.showActions(),e(".selectpicker").selectpicker()}};t.vrAdmin.Krpano=o,e(document).ready(function(){o.init()})}(window,jQuery);var htmlToBBCode=function(t){return t=t.replace(/<pre(.*?)>(.*?)<\/pre>/gim,"[code]$2[/code]"),t=t.replace(/<h[1-7](.*?)>(.*?)<\/h[1-7]>/,"\n[h]$2[/h]\n"),t=t.replace(/<br(.*?)>/gi,"\n"),t=t.replace(/<textarea(.*?)>(.*?)<\/textarea>/gim,"[code]$2[/code]"),t=t.replace(/<b>/gi,"[b]"),t=t.replace(/<i>/gi,"[i]"),t=t.replace(/<u>/gi,"[u]"),t=t.replace(/<\/b>/gi,"[/b]"),t=t.replace(/<\/i>/gi,"[/i]"),t=t.replace(/<\/u>/gi,"[/u]"),t=t.replace(/<em>/gi,"[b]"),t=t.replace(/<\/em>/gi,"[/b]"),t=t.replace(/<strong>/gi,"[b]"),t=t.replace(/<\/strong>/gi,"[/b]"),t=t.replace(/<cite>/gi,"[i]"),t=t.replace(/<\/cite>/gi,"[/i]"),t=t.replace(/<font color="(.*?)">(.*?)<\/font>/gim,"[color=$1]$2[/color]"),t=t.replace(/<font color=(.*?)>(.*?)<\/font>/gim,"[color=$1]$2[/color]"),t=t.replace(/<link(.*?)>/gi,""),t=t.replace(/<li(.*?)>(.*?)<\/li>/gi,"[*]$2"),t=t.replace(/<ul(.*?)>/gi,"[list]"),t=t.replace(/<\/ul>/gi,"[/list]"),t=t.replace(/<div>/gi,"\n"),t=t.replace(/<\/div>/gi,"\n"),t=t.replace(/<td(.*?)>/gi," "),t=t.replace(/<tr(.*?)>/gi,"\n"),t=t.replace(/<img(.*?)src="(.*?)"(.*?)>/gi,"[img]$2[/img]"),t=t.replace(/<a(.*?)href="(.*?)"(.*?)>(.*?)<\/a>/gi,"[url=$2]$4[/url]"),t=t.replace(/<head>(.*?)<\/head>/gim,""),t=t.replace(/<object>(.*?)<\/object>/gim,""),t=t.replace(/<script(.*?)>(.*?)<\/script>/gim,""),t=t.replace(/<style(.*?)>(.*?)<\/style>/gim,""),t=t.replace(/<title>(.*?)<\/title>/gim,""),t=t.replace(/ <!--(.*?)-->/gim,"\n"),t=t.replace(/\/\//gi,"/"),t=t.replace(/http:\//gi,"http://"),t=t.replace(/<(?:[^>'"]*|(['"]).*?\1)*>/gim,""),t=t.replace(/\r\r/gi,""),t=t.replace(/\[img]\//gi,"[img]"),t=t.replace(/\[url=\//gi,"[url="),t=t.replace(/(\S)\n/gi,"$1 ")},krpano=document.getElementById("krpanoSWFObject");krpano.call("autorotate.stop()");var add_hotpost=document.getElementById("add_hotpost"),hotspot_done=document.getElementById("add_text"),selectbox=document.getElementById("selectbox"),showlink=document.getElementById("show_link"),i=0,hotspots={},uniqname="",scene_nums=krpano.get("scene.count"),hotspotList=[],current_scene="",current_vTour_hotspot_counter=0,current_randome_val=Math.round(1e9*Math.random()).toString()+Math.round(1e9*Math.random()).toString(),removedHotspot=[],defaultViewList={},superHotspot;setTimeout(function(){superHotspot=new superHotspotObj(krpano)},500);